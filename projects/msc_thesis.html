<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Brian ODonnell">

<title>Thesis Intro</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="msc_thesis_files/libs/clipboard/clipboard.min.js"></script>
<script src="msc_thesis_files/libs/quarto-html/quarto.js"></script>
<script src="msc_thesis_files/libs/quarto-html/popper.min.js"></script>
<script src="msc_thesis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="msc_thesis_files/libs/quarto-html/anchor.min.js"></script>
<link href="msc_thesis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="msc_thesis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="msc_thesis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="msc_thesis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="msc_thesis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<link href="msc_thesis_files/libs/table1-1.0/table1_defaults.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Thesis Intro</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Workbook document</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Brian ODonnell </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Charité - Universitätsmedizin Berlin
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  

</header>

<p>Goals</p>
<ul>
<li><p>Quarto practice</p></li>
<li><p>Noshow data: cleaning, crosscorr, and logit reg practice with the <a href="https://www.tidymodels.org/start/case-study">tidymodels</a> workflow using the Brazil appointment (appt) <a href="https://www.kaggle.com/datasets/joniarroba/noshowappointments">noshow dataset</a></p></li>
<li><p>Import of dummy hypertension data from DHIS2 package to do a <strong>Table1</strong> for never returners</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#| label: load-packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> <span class="co">#| include: false</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a> <span class="co">#| echo: false</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(table1)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(slider)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(summarytools)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="quarto-table-practice" class="level2">
<h2 class="anchored" data-anchor-id="quarto-table-practice">Quarto table practice</h2>
<p>testing out quarto function to make a table</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>table1<span class="sc">::</span><span class="fu">table1</span>(<span class="sc">~</span> mpg <span class="sc">+</span> cyl <span class="sc">|</span> <span class="fu">factor</span>(vs), <span class="at">data=</span>mtcars, <span class="at">caption=</span><span class="st">"CARS: mpg and cyl by vs"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="Rtable1">
<table class="Rtable1 table table-sm table-striped small" data-quarto-postprocess="true">
<caption>CARS: mpg and cyl by vs</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th class="rowlabel firstrow lastrow" data-quarto-table-cell-role="th"></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">0<br>
<span class="stratn">(N=18)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">1<br>
<span class="stratn">(N=14)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Overall<br>
<span class="stratn">(N=32)</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowlabel firstrow">mpg</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>16.6 (3.86)</td>
<td>24.6 (5.38)</td>
<td>20.1 (6.03)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">15.7 [10.4, 26.0]</td>
<td class="lastrow">22.8 [17.8, 33.9]</td>
<td class="lastrow">19.2 [10.4, 33.9]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">cyl</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>7.44 (1.15)</td>
<td>4.57 (0.938)</td>
<td>6.19 (1.79)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">8.00 [4.00, 8.00]</td>
<td class="lastrow">4.00 [4.00, 6.00]</td>
<td class="lastrow">6.00 [4.00, 8.00]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="noshow-data-practice" class="level2">
<h2 class="anchored" data-anchor-id="noshow-data-practice">Noshow data practice</h2>
<p>Now lets start importing the noshow data as practice.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#| label: load-data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a> <span class="co">#| include: true</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> <span class="co">#| echo: false</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>dta<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"kaggle.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"day"</span>),as.Date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Explore the data. Start by counting the number of appointments and noshows per patient.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tots <span class="ot">&lt;-</span> dta <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(patient_id,no_show) <span class="sc">%&gt;%</span> <span class="fu">tally</span>()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>tots <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
# Groups:   patient_id [6]
  patient_id no_show     n
       &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt;
1     39218. No          1
2     43742. No          1
3     93780. No          1
4    141724. No          1
5    537615. No          1
6   5628261  Yes         1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tots %&gt;% </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot()+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_histogram(aes(x=n))</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># tots %&gt;% arrange(-n)</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>tots <span class="sc">%&gt;%</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">n_group =</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        n<span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"1"</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        n<span class="sc">&gt;</span><span class="dv">1</span> <span class="sc">&amp;</span> n<span class="sc">&lt;</span><span class="dv">6</span> <span class="sc">~</span> <span class="st">"1-5"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"6+"</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(no_show, n_group) <span class="sc">%&gt;%</span> </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">percent =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="fu">nrow</span>(tots)) <span class="sc">%&gt;%</span>   </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># janitor::tabyl(n_group,no_show) %&gt;% </span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>n_group,<span class="at">y=</span>percent)) <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>no_show, <span class="at">scales=</span><span class="st">"fixed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="msc_thesis_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On the <code>noshow</code> var: here “no”=appointment was made, and “yes”=appointment was noshow.</p>
<p>Patient load per month per clinic (here we pretend <code>neighborhood</code> is the clinic)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(summarytools)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>dta_pts_per_month<span class="ot">&lt;-</span>dta <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">appt_month=</span>lubridate<span class="sc">::</span><span class="fu">month</span>(appointment_day)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appt_month, neighbourhood) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">patients=</span><span class="fu">n_distinct</span>(patient_id),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">appts=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appt_month<span class="sc">&gt;</span><span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pa_ratio=</span>appts<span class="sc">/</span>patients)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>dta_pts_per_month <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  summarytools<span class="sc">::</span><span class="fu">descr</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Descriptive Statistics  
dta_pts_per_month  
N: 160  

                    appt_month     appts   pa_ratio   patients
----------------- ------------ --------- ---------- ----------
             Mean         5.49    670.58       1.42     446.88
          Std.Dev         0.50    823.45       0.23     509.53
              Min         5.00      1.00       1.00       1.00
               Q1         5.00    133.50       1.22      98.00
           Median         5.00    399.50       1.36     281.50
               Q3         6.00    843.50       1.58     591.50
              Max         6.00   5761.00       2.33    3375.00
              MAD         0.00    426.99       0.26     305.42
              IQR         1.00    705.50       0.36     492.75
               CV         0.09      1.23       0.16       1.14
         Skewness         0.02      2.69       0.55       2.45
      SE.Skewness         0.19      0.19       0.19       0.19
         Kurtosis        -2.01     10.37       0.33       8.44
          N.Valid       160.00    160.00     160.00     160.00
        Pct.Valid       100.00    100.00     100.00     100.00</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %&gt;% summarize(patient_avg=mean(patients),</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#             appt_avg=mean(appts))</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>dta_pts_per_month <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>appts),<span class="at">bins=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="msc_thesis_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Check out distributions of all the vars including patients appts ratio at each clinic per month.</p>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dta_pts_per_month <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  summarytools<span class="sc">::</span><span class="fu">dfSummary</span>(<span class="at">plain.ascii =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">method=</span><span class="st">"render"</span>, <span class="at">varnumbers   =</span> <span class="cn">FALSE</span>, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">valid.col    =</span> <span class="cn">FALSE</span>, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">graph.magnif =</span> <span class="fl">0.76</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="container st-container">
<h3 class="anchored">Data Frame Summary</h3>
<h4 class="anchored">dta_pts_per_month</h4>
<strong>Dimensions</strong>: 160 x 5
  <br><strong>Duplicates</strong>: 0
<br>

<table class="table table-striped table-bordered st-table st-table-striped st-table-bordered st-multiline" data-quarto-postprocess="true">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Variable</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Stats / Values</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Freqs (% of Valid)</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Graph</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Missing</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">appt_month [numeric]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table data-quarto-postprocess="true" class="table">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Min : 5</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean : 5.5</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Max : 6</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; padding: 0; vertical-align: middle;"><table data-quarto-postprocess="true" class="table">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">5</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">81</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">50.6%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">6</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">79</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">49.4%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAFgAAAA3BAMAAAB6GZCIAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAPUExURf////3+/aampvDw8P///7GHRIEAAAACdFJOUwAAdpPNOAAAAAFiS0dEAIgFHUgAAAAHdElNRQfoBBILKS/akUfIAAAAO0lEQVRIx2NgGJpAiSgAVaxsTAQwGlU8qnhUMa0Uk5RhBYkCNFdMlJMVSQmNUcWjikcV00wxSRl2qAEA745GpDXY1lwAAAAASUVORK5CYII=" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="even">
<td style="text-align: left;">neighbourhood [character]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table data-quarto-postprocess="true" class="table">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">1. AEROPORTO</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">2. ANDORINHAS</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">3. ANTÔNIO HONÓRIO</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">4. ARIOVALDO FAVALESSA</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">5. BARRO VERMELHO</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">6. BELA VISTA</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">7. BENTO FERREIRA</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">8. BOA VISTA</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">9. BONFIM</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">10. CARATOÍRA</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">[ 71 others ]</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; padding: 0; vertical-align: middle;"><table data-quarto-postprocess="true" class="table">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">2</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">1.2%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">2</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">1.2%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">2</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">1.2%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">2</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">1.2%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">2</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">1.2%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">2</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">1.2%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">2</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">1.2%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">2</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">1.2%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">2</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">1.2%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">2</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">1.2%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">140</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">87.5%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAJAAAAEKBAMAAAAP4sEaAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAPUExURf////3+/aampvDw8P///7GHRIEAAAACdFJOUwAAdpPNOAAAAAFiS0dEAIgFHUgAAAAHdElNRQfoBBILKS/akUfIAAAAs0lEQVR42u3VwQ2DQAwEQFqghEAHSf+95ROeIKTjVpYzW8A8vJJ3WeROttc6mB+0g0AgEOgEeuzVjjL/ANk1EAgEmg7ZteCN6tUPAoFA7SC7FrxRvfpBIBCoHWTXgjeqVz8IBAJVgcxRELJrIBAINB2ya0HIroFAINB0yK4Fb1SvfhAIBGoH2bXgjerVDwKBQO0guxa8Ub36QSAQqApkjoLQNpyj/s9g3iAQCNQVeuzVynW+gtIrbizRYhQAAAAASUVORK5CYII=" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">patients [integer]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table data-quarto-postprocess="true" class="table">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean (sd) : 446.9 (509.5)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">min ≤ med ≤ max:</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">1 ≤ 281.5 ≤ 3375</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">IQR (CV) : 492.8 (1.1)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle;">146 distinct values</td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAJgAAABuBAMAAAApJ8cWAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAPUExURf////3+/aampvDw8P///7GHRIEAAAACdFJOUwAAdpPNOAAAAAFiS0dEAIgFHUgAAAAHdElNRQfoBBILKS/akUfIAAAAbElEQVRo3u3YvQmAMBCA0aygGxg3MPvvZhPTGIT8gEXeV131ODhIkRDUUywdW38ZO9MTDAaDwWAwGAwGg8FgMBgMBoPB/sVGvn9f2MiOMBgMtgDW/uZ+YO07wmqnmICV6VoN22OljMUpBfV0AxQpmhJNk5qhAAAAAElFTkSuQmCC" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="even">
<td style="text-align: left;">appts [integer]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table data-quarto-postprocess="true" class="table">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean (sd) : 670.6 (823.5)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">min ≤ med ≤ max:</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">1 ≤ 399.5 ≤ 5761</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">IQR (CV) : 705.5 (1.2)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle;">153 distinct values</td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAJgAAABuBAMAAAApJ8cWAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAPUExURf////3+/aampvDw8P///7GHRIEAAAACdFJOUwAAdpPNOAAAAAFiS0dEAIgFHUgAAAAHdElNRQfoBBILKS/akUfIAAAAhUlEQVRo3u3ZQQqAIBCFYa9QN2i8Qd7/bpG6Kg19WRD9b+HCxccgOILjHFFiMct0LxnzYQ8YGBgYGBgYGBgYGBgYGBgYGBjYF7H0WTgIi+sKBgYGBvY0pjfvAhbk+qqYMoiqYsrbB/YfrHPseY35vvpex5pvfgt2aibz8SjThmXMhsQRJRuNn1+X8aYu8wAAAABJRU5ErkJggg==" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pa_ratio [numeric]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table data-quarto-postprocess="true" class="table">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean (sd) : 1.4 (0.2)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">min ≤ med ≤ max:</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">1 ≤ 1.4 ≤ 2.3</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">IQR (CV) : 0.4 (0.2)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle;">155 distinct values</td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAJgAAABuBAMAAAApJ8cWAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAPUExURf////3+/aampvDw8P///7GHRIEAAAACdFJOUwAAdpPNOAAAAAFiS0dEAIgFHUgAAAAHdElNRQfoBBILKS/akUfIAAAAeUlEQVRo3u3XsQ2AIBBAUVbQDdQNdP/dTEzkCg3JKY3m/YpQPGgIUIqeNNTm2jRku2DLdgaDwWAw2M+x/A3awPJ7hMFgMBgMlsbi9u6A3RExiqU6YHW0wmAwGAwGg8FgX8faT+UkVqdWGAx2NMYR64DF3OVb/aaiJ+2P5lM4Y8cIoAAAAABJRU5ErkJggg==" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
</tbody>
</table>

<p>Generated by <a href="https://github.com/dcomtois/summarytools">summarytools</a> 1.0.1 (<a href="https://www.r-project.org/">R</a> version 4.3.2)<br>2024-04-18</p>
</div>
</div>
<p>Now lets make a line graph of all the appointments. First lets test if there is any difference between noshows and shows for every day of observartions.</p>
<p>We’ll first do a T test</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dta_tl <span class="ot">&lt;-</span>dta <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(no_show,<span class="fu">contains</span>(<span class="st">"_day"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   add_count(appointment_day, name="n_appts") %&gt;% </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add_count(scheduled_day, name="n_scheds") %&gt;% </span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"appointment_day"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"scheduled_day"</span>)),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to=</span><span class="st">"date_type"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to=</span><span class="st">"date"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrange(desc(date))</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">everything</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">date =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(date), <span class="fu">max</span>(date), <span class="at">by=</span><span class="st">"day"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n=</span><span class="fu">replace_na</span>(n,<span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(date&gt;as.Date("2016-04-01")) %&gt;% </span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date_type<span class="sc">==</span><span class="st">"appointment_day"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(no_show) <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_seven_day =</span> <span class="fu">slide_index_dbl</span>( <span class="do">#### Give it an index for a sliding window</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    n,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">.i=</span>date,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> <span class="sc">~</span><span class="fu">mean</span>(.x, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">.before =</span> <span class="fu">days</span>(<span class="dv">7</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co"># dta_test&lt;-dta_tl %&gt;% </span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(date,no_show,n) %&gt;% </span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(names_from=no_show,</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co">#               values_from=n)</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co"># noshow_n_days&lt;-dta_tl %&gt;% filter(no_show=="No") %&gt;% select(n)</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="co"># noshow_y_days&lt;-dta_tl %&gt;% filter(no_show=="Yes") %&gt;% select(n)</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="co"># t.test(noshow_n_days$n ~ noshow_y_days$n)</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="do">## T test,... is the noshow days different with total appts in each day??</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(n<span class="sc">~</span>no_show, <span class="at">data=</span>dta_tl) <span class="sc">%&gt;%</span> </span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 21%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">estimate1</th>
<th style="text-align: right;">estimate2</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">parameter</th>
<th style="text-align: right;">conf.low</th>
<th style="text-align: right;">conf.high</th>
<th style="text-align: left;">method</th>
<th style="text-align: left;">alternative</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1607.049</td>
<td style="text-align: right;">2151.415</td>
<td style="text-align: right;">544.3659</td>
<td style="text-align: right;">5.984218</td>
<td style="text-align: right;">3e-07</td>
<td style="text-align: right;">45.16183</td>
<td style="text-align: right;">1066.219</td>
<td style="text-align: right;">2147.878</td>
<td style="text-align: left;">Welch Two Sample t-test</td>
<td style="text-align: left;">two.sided</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The difference is significant at least.</p>
<p>Now make the line graph, any changes over time?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dta_tl <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pivot_longer(cols=all_of(c("appointment_day",</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                          "scheduled_day")),</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#              names_to="date_type",</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#              values_to="date") %&gt;% </span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select(no_show,contains("date"),contains("n_"))</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># summarize(appt=n(appointment_day),</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           sched=n(scheduled_day))</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>date)) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">y=</span>n),<span class="at">fill=</span><span class="st">"grey80"</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>mean_seven_day, <span class="at">color=</span>date_type),<span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels=</span><span class="st">"%Y %b %d"</span>) <span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>no_show, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales=</span><span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Was the appointment a no show? Shown over duration of dataset"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="msc_thesis_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dta_tl <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [82 × 5] (S3: tbl_df/tbl/data.frame)
 $ no_show       : chr [1:82] "No" "Yes" "No" "Yes" ...
 $ date_type     : chr [1:82] "appointment_day" "appointment_day" "appointment_day" "appointment_day" ...
 $ date          : Date[1:82], format: "2016-04-29" "2016-04-29" ...
 $ n             : int [1:82] 2602 633 0 0 0 0 3515 861 3425 831 ...
 $ mean_seven_day: num [1:82] 2602 633 1301 316 867 ...</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("slider")</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(slider)</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("tidyquant")</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(dta$appointment_day)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Looks like not much difference in temporal trends of noshows.</p>
</section>
<section id="cleaning-and-cross-correlation" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-and-cross-correlation">Cleaning and Cross Correlation</h2>
<p>That was fun. Now lets clean up the data to perform a logistic regression and then see how to use prediction methods…</p>
<p>1) Clean up data</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dta_clean <span class="ot">&lt;-</span> dta <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#remove duplicate appointments for same patient and same day</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">duplicated</span>(<span class="fu">across</span>(<span class="sc">-</span>appointment_id))) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create a day of the week variable</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wday=</span><span class="fu">wday</span>(appointment_day,<span class="at">label=</span><span class="cn">TRUE</span>,<span class="at">abbr=</span><span class="cn">TRUE</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">is_friday=</span><span class="fu">as.factor</span>(<span class="fu">if_else</span>(wday<span class="sc">==</span><span class="st">"Fri"</span>,<span class="dv">1</span>,<span class="dv">0</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create var number of patients seen at clinic/neighborhood in total</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(neighbourhood,<span class="at">name=</span><span class="st">"neigh_appts"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># factorize vars and create a diff between appt and scheduled date</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender=</span><span class="fu">as.factor</span>(gender),</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">gender_male=</span><span class="fu">as.factor</span>(<span class="fu">if_else</span>(gender<span class="sc">==</span><span class="st">"M"</span>,<span class="dv">1</span>,<span class="dv">0</span>)),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">attended=</span><span class="fu">as.factor</span>(<span class="fu">case_match</span>(no_show,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"No"</span><span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Yes"</span><span class="sc">~</span><span class="dv">0</span>)),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">days_since_call=</span><span class="fu">as.double</span>(<span class="fu">difftime</span>(appointment_day, scheduled_day, <span class="at">units=</span><span class="st">"days"</span>))</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(scholarship<span class="sc">:</span>sms_received, as.factor)) <span class="sc">%&gt;%</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"_id"</span>),as.factor)) <span class="sc">%&gt;%</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create tallies</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(patient_id,appointment_day) <span class="sc">%&gt;%</span> </span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(patient_id, <span class="at">name=</span><span class="st">"appt_count"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(patient_id) <span class="sc">%&gt;%</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"one"</span><span class="ot">=</span><span class="dv">1</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>         <span class="st">"appt_tally"</span><span class="ot">=</span><span class="fu">cumsum</span>(one)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>one) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>dta_clean <span class="sc">%&gt;%</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># colnames() %&gt;% </span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>patient_id <span class="sc">&amp;</span> <span class="sc">!</span>appointment_id) <span class="sc">%&gt;%</span> </span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  skimr<span class="sc">::</span><span class="fu">skim</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">Piped data</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">106305</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Date</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">neighbourhood</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">no_show</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: Date</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">min</th>
<th style="text-align: left;">max</th>
<th style="text-align: left;">median</th>
<th style="text-align: right;">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">scheduled_day</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2015-11-10</td>
<td style="text-align: left;">2016-06-08</td>
<td style="text-align: left;">2016-05-10</td>
<td style="text-align: right;">111</td>
</tr>
<tr class="even">
<td style="text-align: left;">appointment_day</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2016-04-29</td>
<td style="text-align: left;">2016-06-08</td>
<td style="text-align: left;">2016-05-18</td>
<td style="text-align: right;">27</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">gender</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">F: 69588, M: 36717</td>
</tr>
<tr class="even">
<td style="text-align: left;">scholarship</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">0: 95880, 1: 10425</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hipertension</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">0: 85156, 1: 21149</td>
</tr>
<tr class="even">
<td style="text-align: left;">diabetes</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">0: 98572, 1: 7733</td>
</tr>
<tr class="odd">
<td style="text-align: left;">alcoholism</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">0: 103330, 1: 2975</td>
</tr>
<tr class="even">
<td style="text-align: left;">handcap</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">0: 104186, 1: 1928, 2: 177, 3: 11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sms_received</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">0: 70831, 1: 35474</td>
</tr>
<tr class="even">
<td style="text-align: left;">wday</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">Tue: 24876, Wed: 24818, Mon: 21803, Fri: 18062</td>
</tr>
<tr class="odd">
<td style="text-align: left;">is_friday</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">0: 88243, 1: 18062</td>
</tr>
<tr class="even">
<td style="text-align: left;">gender_male</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">0: 69588, 1: 36717</td>
</tr>
<tr class="odd">
<td style="text-align: left;">attended</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1: 84615, 0: 21690</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 3%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">37.12</td>
<td style="text-align: right;">23.17</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">115</td>
<td style="text-align: left;">▇▇▇▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">neigh_appts</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2615.11</td>
<td style="text-align: right;">1811.84</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1332</td>
<td style="text-align: right;">2208</td>
<td style="text-align: right;">3169</td>
<td style="text-align: right;">7413</td>
<td style="text-align: left;">▆▇▃▁▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">days_since_call</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10.41</td>
<td style="text-align: right;">15.37</td>
<td style="text-align: right;">-6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">179</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">appt_count</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.83</td>
<td style="text-align: right;">2.96</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">35</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">appt_tally</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.91</td>
<td style="text-align: right;">1.87</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">35</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
</tbody>
</table>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>dta_clean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 106,305 × 22
   patient_id   appointment_id gender scheduled_day appointment_day   age
   &lt;fct&gt;        &lt;fct&gt;          &lt;fct&gt;  &lt;date&gt;        &lt;date&gt;          &lt;dbl&gt;
 1 39217.84439  5751990        F      2016-05-31    2016-06-03         44
 2 43741.75652  5760144        M      2016-06-01    2016-06-01         39
 3 93779.52927  5712759        F      2016-05-18    2016-05-18         33
 4 141724.16655 5637648        M      2016-04-29    2016-05-02         12
 5 537615.28476 5637728        F      2016-04-29    2016-05-06         14
 6 5628261      5680449        M      2016-05-10    2016-05-13         13
 7 11831856     5718578        M      2016-05-19    2016-05-19         16
 8 22638656     5580835        F      2016-04-14    2016-05-03         22
 9 22638656     5715081        F      2016-05-18    2016-06-08         23
10 52168938     5704816        F      2016-05-16    2016-05-16         28
# ℹ 106,295 more rows
# ℹ 16 more variables: neighbourhood &lt;chr&gt;, scholarship &lt;fct&gt;,
#   hipertension &lt;fct&gt;, diabetes &lt;fct&gt;, alcoholism &lt;fct&gt;, handcap &lt;fct&gt;,
#   sms_received &lt;fct&gt;, no_show &lt;chr&gt;, wday &lt;ord&gt;, is_friday &lt;fct&gt;,
#   neigh_appts &lt;int&gt;, gender_male &lt;fct&gt;, attended &lt;fct&gt;,
#   days_since_call &lt;dbl&gt;, appt_count &lt;int&gt;, appt_tally &lt;dbl&gt;</code></pre>
</div>
</div>
<p>2) Correlation matrix with cleaned data</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("ggcorrplot")</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>dta_clean_noid<span class="ot">&lt;-</span>dta_clean  <span class="sc">%&gt;%</span>   </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>patient_id <span class="sc">&amp;</span> <span class="sc">!</span>appointment_id <span class="sc">&amp;</span> <span class="sc">!</span>handcap <span class="sc">&amp;</span> <span class="sc">!</span>gender_male <span class="sc">&amp;</span> <span class="sc">!</span>wday) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.factor))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>dta_clean_noid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 106,305 × 8
   gender scholarship hipertension diabetes alcoholism sms_received is_friday
   &lt;fct&gt;  &lt;fct&gt;       &lt;fct&gt;        &lt;fct&gt;    &lt;fct&gt;      &lt;fct&gt;        &lt;fct&gt;    
 1 F      0           0            0        0          0            1        
 2 M      0           0            1        0          0            0        
 3 F      0           0            0        0          0            0        
 4 M      0           0            0        0          0            0        
 5 F      0           0            0        0          1            1        
 6 M      0           0            0        0          0            1        
 7 M      0           0            0        0          0            0        
 8 F      0           0            0        0          1            0        
 9 F      0           0            0        0          1            0        
10 F      0           0            0        0          0            0        
# ℹ 106,295 more rows
# ℹ 1 more variable: attended &lt;fct&gt;</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(<span class="sc">~</span><span class="dv">0</span><span class="sc">+</span>., <span class="at">data=</span>dta_clean_noid) <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(<span class="at">use=</span><span class="st">"pairwise.complete.obs"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  ggcorrplot<span class="sc">::</span><span class="fu">ggcorrplot</span>(<span class="at">show.diag =</span> F,<span class="at">type=</span><span class="st">"lower"</span>,<span class="at">lab=</span><span class="cn">TRUE</span>, <span class="at">lab_size=</span><span class="dv">2</span>, <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="msc_thesis_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="predictions-with-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="predictions-with-logistic-regression">Predictions with Logistic Regression</h2>
<p>Following workflow from: <a href="https://www.tidymodels.org/start/case-study/" class="uri">https://www.tidymodels.org/start/case-study/</a></p>
<p>1) Split into training and validation and test sets</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># some of these vars are not necesary now or better processed by recipe</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># outcome is still attended</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>dta_clean2<span class="ot">&lt;-</span>dta_clean <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(gender,scheduled_day,wday,is_friday,no_show,neighbourhood, patient_id))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>splits      <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(dta_clean2, <span class="at">strata =</span> attended)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>appts_other <span class="ot">&lt;-</span> <span class="fu">training</span>(splits)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>appts_test  <span class="ot">&lt;-</span> <span class="fu">testing</span>(splits)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># appts_other %&gt;% </span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   count(attended) %&gt;% </span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(prop = n/sum(n))</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co"># appts_test %&gt;% </span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   count(attended) %&gt;% </span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(prop = n/sum(n))</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co"># appts_other</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>val_set <span class="ot">&lt;-</span> <span class="fu">validation_split</span>(appts_other, </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>                            <span class="at">strata =</span> attended, </span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>                            <span class="at">prop =</span> <span class="fu">c</span>(<span class="fl">0.8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>2) Build the model</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>lr_mod <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>3) Build the “recipe” to preprocess the data</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>lr_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(attended <span class="sc">~</span> ., <span class="at">data =</span> appts_other) <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(appointment_id, <span class="at">new_role =</span> <span class="st">"ID"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span>(appointment_day, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"dow"</span>, <span class="st">"month"</span>)) <span class="sc">%&gt;%</span>               </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(appointment_day) <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># step_corr(all_numeric_predictors(), threshold = .5)</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4) Now we add a workflow, combining the model and recipe</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>lr_workflow<span class="ot">&lt;-</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lr_mod) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(lr_recipe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>5) Create penalty values for tuning</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>lr_reg_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">penalty =</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">40</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>6) Now we apply these each of these penalty values to the workflow (ie with recipe and model)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">321</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("glmnet")</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>lr_res <span class="ot">&lt;-</span> lr_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(val_set,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> lr_reg_grid,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc))</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>lr_plot <span class="ot">&lt;-</span> </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  lr_res <span class="sc">%&gt;%</span> </span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> penalty, <span class="at">y =</span> mean)) <span class="sc">+</span> </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Area under the ROC Curve"</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>lr_plot </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="msc_thesis_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Lets try to find the best model… looks like higher penalty actually performs better!!</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>lr_res <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(penalty) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40 × 8
   rowid  penalty .metric .estimator  mean     n std_err .config              
   &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
 1     1 0.0001   roc_auc binary     0.652     1      NA Preprocessor1_Model01
 2     2 0.000119 roc_auc binary     0.652     1      NA Preprocessor1_Model02
 3     3 0.000143 roc_auc binary     0.652     1      NA Preprocessor1_Model03
 4     4 0.000170 roc_auc binary     0.652     1      NA Preprocessor1_Model04
 5     5 0.000203 roc_auc binary     0.652     1      NA Preprocessor1_Model05
 6     6 0.000242 roc_auc binary     0.652     1      NA Preprocessor1_Model06
 7     7 0.000289 roc_auc binary     0.652     1      NA Preprocessor1_Model07
 8     8 0.000346 roc_auc binary     0.652     1      NA Preprocessor1_Model08
 9     9 0.000412 roc_auc binary     0.652     1      NA Preprocessor1_Model09
10    10 0.000492 roc_auc binary     0.652     1      NA Preprocessor1_Model10
# ℹ 30 more rows</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">###Seems to be row 38... high mean roc_auc while also being the highest penalty</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>lr_best<span class="ot">&lt;-</span>  lr_res <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(penalty) <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">38</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>OK, now lets see how this ROC curve looks for the best fit log model….</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>lr_auc <span class="ot">&lt;-</span> lr_res <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>(<span class="at">parameters =</span> lr_best) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(attended, .pred_0) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"Logistic Regression"</span>) </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(lr_auc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="msc_thesis_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>lr_res <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>(<span class="at">parameters =</span> lr_best) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15,947 × 7
   id         .pred_0 .pred_1  .row penalty attended .config              
   &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;fct&gt;    &lt;chr&gt;                
 1 validation   0.206   0.794    14  0.0702 0        Preprocessor1_Model38
 2 validation   0.209   0.791    24  0.0702 0        Preprocessor1_Model38
 3 validation   0.208   0.792    26  0.0702 0        Preprocessor1_Model38
 4 validation   0.208   0.792    27  0.0702 0        Preprocessor1_Model38
 5 validation   0.205   0.795    31  0.0702 0        Preprocessor1_Model38
 6 validation   0.203   0.797    36  0.0702 0        Preprocessor1_Model38
 7 validation   0.205   0.795    39  0.0702 0        Preprocessor1_Model38
 8 validation   0.202   0.798    43  0.0702 0        Preprocessor1_Model38
 9 validation   0.203   0.797    44  0.0702 0        Preprocessor1_Model38
10 validation   0.203   0.797    53  0.0702 0        Preprocessor1_Model38
# ℹ 15,937 more rows</code></pre>
</div>
</div>
<p>its… not great!</p>
<p>But we can see how it would fit onto the test data now.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>last_log_mod <span class="ot">&lt;-</span>  <span class="fu">logistic_reg</span>(<span class="at">penalty =</span> lr_best<span class="sc">$</span>penalty[<span class="dv">1</span>], <span class="at">mixture=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>, <span class="at">importance=</span><span class="st">"BIC"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the last workflow</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>last_log_workflow <span class="ot">&lt;-</span> lr_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">update_model</span>(last_log_mod)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># last fit</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>last_lr_fit<span class="ot">&lt;-</span> last_log_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">last_fit</span>(splits)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co"># show metrics</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>last_lr_fit <span class="sc">%&gt;%</span> </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric  .estimator .estimate .config             
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 accuracy binary         0.796 Preprocessor1_Model1
2 roc_auc  binary         0.696 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>About same ROC as with validation set…</p>
<p>7) Finally, we look at the top variables/features included</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>last_lr_fit <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">20</span>, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">fill=</span>Sign)) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="msc_thesis_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Looks like the days since the last call was most important by far!!!</p>
<p>Next after was the SMS received… but from correlation matrix, it seemed to have an inverse effect. Should explore more!</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cor.test(dta_clean$sms_received, dta_clean$no_show)</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># chisq.test(dta_clean$sms_received, dta_clean$no_show)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="dhis2-hypertension-registry-test-run" class="level2">
<h2 class="anchored" data-anchor-id="dhis2-hypertension-registry-test-run">DHIS2 Hypertension Registry Test Run</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(readxl)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>dhis<span class="ot">&lt;-</span>readxl<span class="sc">::</span><span class="fu">read_xls</span>(<span class="st">"dhis.xls"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>dhis_clean<span class="ot">&lt;-</span>dhis <span class="sc">%&gt;%</span> </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"date"</span>), as.Date)) <span class="sc">%&gt;%</span> <span class="co"># convert to date everything thats a date</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"mm_hg"</span>),as.double)) <span class="sc">%&gt;%</span> <span class="co"># BP should be character</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gen_address_current,gen_given_name,gen_date_of_birth) <span class="sc">%&gt;%</span> <span class="co">#create patient IDs based on address DOB name</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">patient_id=</span><span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">has_support=</span><span class="sc">!</span><span class="fu">is.na</span>(supporters_name), <span class="co">#add a dummy var if patient has a supporter</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex=</span>gen_sex,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_at_entry=</span><span class="fu">floor</span>(lubridate<span class="sc">::</span><span class="fu">time_length</span>(<span class="fu">difftime</span>(registration_date, gen_date_of_birth), </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                                                                <span class="st">"years"</span>)) <span class="co">#calc age and sex</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(<span class="at">name=</span><span class="st">"total_patient_visits"</span>) <span class="sc">%&gt;%</span> <span class="co"># counter for total patients visits</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(patient_id,event_date) <span class="sc">%&gt;%</span> <span class="co">#now make a running tally for each patient visits</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(patient_id) <span class="sc">%&gt;%</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"one"</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">"appt_tally"</span><span class="ot">=</span><span class="fu">cumsum</span>(one)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>one) <span class="sc">%&gt;%</span> </span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">days_since_entry=</span><span class="fu">as.double</span>(<span class="fu">difftime</span>(registration_date, event_date, <span class="at">units=</span><span class="st">"days"</span>))) <span class="sc">%&gt;%</span> <span class="co">#days since entry</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"gen"</span>) <span class="sc">&amp;</span> <span class="sc">!</span>supporters_name)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="co"># dhis %&gt;% </span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   count(has_support)</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="co"># dhis_clean %&gt;% head()</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="co"># dhis %&gt;% </span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   colnames()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Still need to clean up the presecriptions etc…</p>
<p>Process it for the <strong>Table1</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dhis_table <span class="ot">&lt;-</span> dhis_clean <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">patient_returned=</span><span class="fu">if_else</span>(total_patient_visits<span class="sc">&gt;</span><span class="dv">1</span>, <span class="st">"1+ Visits After Entry"</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"LTFU After Entry"</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                                    )) <span class="sc">%&gt;%</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sbp_level =</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>        ncd_systole_mm_hg <span class="sc">&gt;=</span> <span class="dv">140</span>                         <span class="sc">~</span> <span class="st">"very_high"</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>        ncd_systole_mm_hg <span class="sc">&gt;=</span> <span class="dv">130</span> <span class="sc">&amp;</span> ncd_systole_mm_hg <span class="sc">&lt;</span> <span class="dv">140</span> <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>        ncd_systole_mm_hg <span class="sc">&gt;=</span> <span class="dv">120</span> <span class="sc">&amp;</span> ncd_systole_mm_hg <span class="sc">&lt;</span> <span class="dv">130</span> <span class="sc">~</span> <span class="st">"elevated"</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.na</span>(ncd_systole_mm_hg) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"normal"</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sbp_level=</span><span class="fu">fct_relevel</span>(sbp_level, </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">c</span>(<span class="st">"normal"</span>,<span class="st">"elevated"</span>,<span class="st">"high"</span>,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"very_high"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">as.factor</span>(<span class="fu">cut</span>(age_at_entry, </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">55</span>, <span class="dv">60</span>, <span class="dv">75</span>, <span class="dv">100</span>), </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">include.lowest =</span> T, </span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"40-55"</span>,<span class="st">"55-60"</span>, <span class="st">"60-75"</span>, <span class="st">"75-100"</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(patient_returned, sex, age_group, appt_tally,</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>         <span class="st">"sbp_baseline"</span><span class="ot">=</span>sbp_level, <span class="st">"amlodipine_baseline"</span><span class="ot">=</span>med_amlodipine) <span class="sc">%&gt;%</span> </span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appt_tally<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(dhis_clean$age_at_entry)</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>table1<span class="sc">::</span><span class="fu">table1</span>(<span class="sc">~</span> sex <span class="sc">+</span> age_group <span class="sc">+</span> sbp_baseline <span class="sc">+</span> amlodipine_baseline <span class="sc">|</span> <span class="fu">factor</span>(patient_returned), <span class="at">data=</span>dhis_table) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="Rtable1">
<table class="Rtable1 table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th class="rowlabel firstrow lastrow" data-quarto-table-cell-role="th"></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">1+ Visits After Entry<br>
<span class="stratn">(N=1526)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">LTFU After Entry<br>
<span class="stratn">(N=277)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Overall<br>
<span class="stratn">(N=1803)</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowlabel firstrow">sex</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Female</td>
<td>767 (50.3%)</td>
<td>142 (51.3%)</td>
<td>909 (50.4%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Male</td>
<td class="lastrow">759 (49.7%)</td>
<td class="lastrow">135 (48.7%)</td>
<td class="lastrow">894 (49.6%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">age_group</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">40-55</td>
<td>51 (3.3%)</td>
<td>64 (23.1%)</td>
<td>115 (6.4%)</td>
</tr>
<tr class="even">
<td class="rowlabel">55-60</td>
<td>269 (17.6%)</td>
<td>62 (22.4%)</td>
<td>331 (18.4%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">60-75</td>
<td>1206 (79.0%)</td>
<td>151 (54.5%)</td>
<td>1357 (75.3%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">75-100</td>
<td class="lastrow">0 (0%)</td>
<td class="lastrow">0 (0%)</td>
<td class="lastrow">0 (0%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">sbp_baseline</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">normal</td>
<td>159 (10.4%)</td>
<td>10 (3.6%)</td>
<td>169 (9.4%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">elevated</td>
<td>119 (7.8%)</td>
<td>17 (6.1%)</td>
<td>136 (7.5%)</td>
</tr>
<tr class="even">
<td class="rowlabel">high</td>
<td>59 (3.9%)</td>
<td>56 (20.2%)</td>
<td>115 (6.4%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">very_high</td>
<td>1188 (77.9%)</td>
<td>194 (70.0%)</td>
<td>1382 (76.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Missing</td>
<td class="lastrow">1 (0.1%)</td>
<td class="lastrow">0 (0%)</td>
<td class="lastrow">1 (0.1%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">amlodipine_baseline</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Amlodipine(5mg)</td>
<td>183 (12.0%)</td>
<td>19 (6.9%)</td>
<td>202 (11.2%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Missing</td>
<td class="lastrow">1343 (88.0%)</td>
<td class="lastrow">258 (93.1%)</td>
<td class="lastrow">1601 (88.8%)</td>
</tr>
</tbody>
</table>

</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dhis_clean %&gt;% </span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(is.na(ncd_systole_mm_hg))</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># dhis_clean %&gt;% </span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   count(total_patient_visits)</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dhis_clean %&gt;% </span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   count()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>From here:</p>
<ul>
<li><p>Transform hypertension registry data into “long” appointment dataset</p></li>
<li><p>Define and import climate / econ variables and add them</p></li>
<li><p>Validation criteria for prediction model?</p></li>
<li><p>Cox PH - Discrete time or continuous time?</p></li>
</ul>
</section>
<section id="analysis-plan---outline" class="level2">
<h2 class="anchored" data-anchor-id="analysis-plan---outline"><strong>Analysis Plan - Outline</strong></h2>
<ul>
<li><p>Import DHIS2 line list data</p></li>
<li><p>transform variables as needed and do a data inspection</p>
<ul>
<li><p>avg total number of visits per client</p></li>
<li><p>appts per month enrolled</p></li>
<li><p>missing data analysis</p></li>
<li><p>days since last appt for each pnt</p></li>
<li><p>mean patient load per month per clinic</p></li>
<li><p>hist of total vists by age/region/sex</p></li>
<li><p>dummy vars for each of the medications prescribed</p>
<ul>
<li>and whether prescribed within appropriate window since registration</li>
</ul></li>
</ul></li>
<li><p>crosstabs of patient level variables including by attendance status groups</p>
<ul>
<li><p>registered without follow up</p></li>
<li><p>had follow up and never dropped out until endline</p></li>
<li><p>had a follow up</p></li>
<li><p>sex and 10year age bands</p></li>
<li><p>SBP above or below 180</p></li>
<li><p>BMI range at enrollment</p></li>
</ul></li>
<li><p>Add date of next appt to each line</p>
<ul>
<li><p>Variable if falls within time of ec or env shock</p></li>
<li><p>dummy var for season of enrollment</p></li>
</ul></li>
<li><p>Patient return model</p>
<ul>
<li><p>logistic reg</p></li>
<li><p>include all vars, then LASSO for vars that are relevant</p></li>
<li><p>bootstrap resampling</p></li>
</ul></li>
<li><p>IFF enough patients return for 2+ FU visits (~40%) then also do a survival analysis for LTFU</p>
<ul>
<li><p>Cox PH model</p></li>
<li><p>include all vars, then LASSO for vars that are relevant</p></li>
<li><p>bootstrap resampling</p></li>
</ul></li>
<li></li>
</ul>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb41" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Thesis Intro"</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Workbook document"</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="an">warning:</span><span class="co"> false</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">  name: Brian ODonnell</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">  affiliation: Charité - Universitätsmedizin Berlin</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>Goals</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Quarto practice</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Noshow data: cleaning, crosscorr, and logit reg practice with the <span class="co">[</span><span class="ot">tidymodels</span><span class="co">](https://www.tidymodels.org/start/case-study)</span> workflow using the Brazil appointment (appt) <span class="co">[</span><span class="ot">noshow dataset</span><span class="co">](https://www.kaggle.com/datasets/joniarroba/noshowappointments)</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Import of dummy hypertension data from DHIS2 package to do a **Table1** for never returners</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a> <span class="co">#| label: load-packages</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a> <span class="co">#| include: false</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a> <span class="co">#| echo: false</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(table1)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(slider)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(summarytools)</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quarto table practice</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>testing out quarto function to make a table</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calculations</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>table1<span class="sc">::</span><span class="fu">table1</span>(<span class="sc">~</span> mpg <span class="sc">+</span> cyl <span class="sc">|</span> <span class="fu">factor</span>(vs), <span class="at">data=</span>mtcars, <span class="at">caption=</span><span class="st">"CARS: mpg and cyl by vs"</span>) </span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a><span class="fu">## Noshow data practice</span></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>Now lets start importing the noshow data as practice.</span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a> <span class="co">#| label: load-data</span></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a> <span class="co">#| include: true</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a> <span class="co">#| echo: false</span></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>dta<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"kaggle.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"day"</span>),as.Date))</span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>Explore the data. Start by counting the number of appointments and noshows per patient.</span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a>tots <span class="ot">&lt;-</span> dta <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(patient_id,no_show) <span class="sc">%&gt;%</span> <span class="fu">tally</span>()</span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a>tots <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a><span class="co"># tots %&gt;% </span></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot()+</span></span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_histogram(aes(x=n))</span></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a><span class="co"># tots %&gt;% arrange(-n)</span></span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a>tots <span class="sc">%&gt;%</span> </span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">n_group =</span></span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a>        n<span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"1"</span>,</span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a>        n<span class="sc">&gt;</span><span class="dv">1</span> <span class="sc">&amp;</span> n<span class="sc">&lt;</span><span class="dv">6</span> <span class="sc">~</span> <span class="st">"1-5"</span>,</span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"6+"</span></span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(no_show, n_group) <span class="sc">%&gt;%</span> </span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">percent =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="fu">nrow</span>(tots)) <span class="sc">%&gt;%</span>   </span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># janitor::tabyl(n_group,no_show) %&gt;% </span></span>
<span id="cb41-106"><a href="#cb41-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-107"><a href="#cb41-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>n_group,<span class="at">y=</span>percent)) <span class="sc">+</span></span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>no_show, <span class="at">scales=</span><span class="st">"fixed"</span>)</span>
<span id="cb41-110"><a href="#cb41-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-111"><a href="#cb41-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-113"><a href="#cb41-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-114"><a href="#cb41-114" aria-hidden="true" tabindex="-1"></a>On the <span class="in">`noshow`</span> var: here "no"=appointment was made, and "yes"=appointment was noshow.</span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true" tabindex="-1"></a>Patient load per month per clinic (here we pretend <span class="in">`neighborhood`</span> is the clinic)</span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true" tabindex="-1"></a><span class="co"># library(summarytools)</span></span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-123"><a href="#cb41-123" aria-hidden="true" tabindex="-1"></a>dta_pts_per_month<span class="ot">&lt;-</span>dta <span class="sc">%&gt;%</span> </span>
<span id="cb41-124"><a href="#cb41-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">appt_month=</span>lubridate<span class="sc">::</span><span class="fu">month</span>(appointment_day)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-125"><a href="#cb41-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appt_month, neighbourhood) <span class="sc">%&gt;%</span> </span>
<span id="cb41-126"><a href="#cb41-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">patients=</span><span class="fu">n_distinct</span>(patient_id),</span>
<span id="cb41-127"><a href="#cb41-127" aria-hidden="true" tabindex="-1"></a>            <span class="at">appts=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb41-128"><a href="#cb41-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-129"><a href="#cb41-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appt_month<span class="sc">&gt;</span><span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-130"><a href="#cb41-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pa_ratio=</span>appts<span class="sc">/</span>patients)</span>
<span id="cb41-131"><a href="#cb41-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-132"><a href="#cb41-132" aria-hidden="true" tabindex="-1"></a>dta_pts_per_month <span class="sc">%&gt;%</span> </span>
<span id="cb41-133"><a href="#cb41-133" aria-hidden="true" tabindex="-1"></a>  summarytools<span class="sc">::</span><span class="fu">descr</span>()</span>
<span id="cb41-134"><a href="#cb41-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-135"><a href="#cb41-135" aria-hidden="true" tabindex="-1"></a><span class="co"># %&gt;% summarize(patient_avg=mean(patients),</span></span>
<span id="cb41-136"><a href="#cb41-136" aria-hidden="true" tabindex="-1"></a><span class="co">#             appt_avg=mean(appts))</span></span>
<span id="cb41-137"><a href="#cb41-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-138"><a href="#cb41-138" aria-hidden="true" tabindex="-1"></a>dta_pts_per_month <span class="sc">%&gt;%</span> </span>
<span id="cb41-139"><a href="#cb41-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb41-140"><a href="#cb41-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>appts),<span class="at">bins=</span><span class="dv">20</span>)</span>
<span id="cb41-141"><a href="#cb41-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-142"><a href="#cb41-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-143"><a href="#cb41-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-144"><a href="#cb41-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-145"><a href="#cb41-145" aria-hidden="true" tabindex="-1"></a>Check out distributions of all the vars including patients appts ratio at each clinic per month.</span>
<span id="cb41-146"><a href="#cb41-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-149"><a href="#cb41-149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-150"><a href="#cb41-150" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: "asis"</span></span>
<span id="cb41-151"><a href="#cb41-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-152"><a href="#cb41-152" aria-hidden="true" tabindex="-1"></a>dta_pts_per_month <span class="sc">%&gt;%</span> </span>
<span id="cb41-153"><a href="#cb41-153" aria-hidden="true" tabindex="-1"></a>  summarytools<span class="sc">::</span><span class="fu">dfSummary</span>(<span class="at">plain.ascii =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-154"><a href="#cb41-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">method=</span><span class="st">"render"</span>, <span class="at">varnumbers   =</span> <span class="cn">FALSE</span>, </span>
<span id="cb41-155"><a href="#cb41-155" aria-hidden="true" tabindex="-1"></a>                <span class="at">valid.col    =</span> <span class="cn">FALSE</span>, </span>
<span id="cb41-156"><a href="#cb41-156" aria-hidden="true" tabindex="-1"></a>                <span class="at">graph.magnif =</span> <span class="fl">0.76</span>)</span>
<span id="cb41-157"><a href="#cb41-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-158"><a href="#cb41-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-159"><a href="#cb41-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-160"><a href="#cb41-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-161"><a href="#cb41-161" aria-hidden="true" tabindex="-1"></a>Now lets make a line graph of all the appointments. First lets test if there is any difference between noshows and shows for every day of observartions.</span>
<span id="cb41-162"><a href="#cb41-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-163"><a href="#cb41-163" aria-hidden="true" tabindex="-1"></a>We'll first do a T test</span>
<span id="cb41-164"><a href="#cb41-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-167"><a href="#cb41-167" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-168"><a href="#cb41-168" aria-hidden="true" tabindex="-1"></a>dta_tl <span class="ot">&lt;-</span>dta <span class="sc">%&gt;%</span> </span>
<span id="cb41-169"><a href="#cb41-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-170"><a href="#cb41-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(no_show,<span class="fu">contains</span>(<span class="st">"_day"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-171"><a href="#cb41-171" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   add_count(appointment_day, name="n_appts") %&gt;% </span></span>
<span id="cb41-172"><a href="#cb41-172" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add_count(scheduled_day, name="n_scheds") %&gt;% </span></span>
<span id="cb41-173"><a href="#cb41-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"appointment_day"</span>,</span>
<span id="cb41-174"><a href="#cb41-174" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"scheduled_day"</span>)),</span>
<span id="cb41-175"><a href="#cb41-175" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to=</span><span class="st">"date_type"</span>,</span>
<span id="cb41-176"><a href="#cb41-176" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to=</span><span class="st">"date"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-177"><a href="#cb41-177" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrange(desc(date))</span></span>
<span id="cb41-178"><a href="#cb41-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">everything</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb41-179"><a href="#cb41-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb41-180"><a href="#cb41-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">date =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(date), <span class="fu">max</span>(date), <span class="at">by=</span><span class="st">"day"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-181"><a href="#cb41-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n=</span><span class="fu">replace_na</span>(n,<span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-182"><a href="#cb41-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-183"><a href="#cb41-183" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(date&gt;as.Date("2016-04-01")) %&gt;% </span></span>
<span id="cb41-184"><a href="#cb41-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date_type<span class="sc">==</span><span class="st">"appointment_day"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-185"><a href="#cb41-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(no_show) <span class="sc">%&gt;%</span></span>
<span id="cb41-186"><a href="#cb41-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb41-187"><a href="#cb41-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_seven_day =</span> <span class="fu">slide_index_dbl</span>( <span class="do">#### Give it an index for a sliding window</span></span>
<span id="cb41-188"><a href="#cb41-188" aria-hidden="true" tabindex="-1"></a>    n,</span>
<span id="cb41-189"><a href="#cb41-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">.i=</span>date,</span>
<span id="cb41-190"><a href="#cb41-190" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> <span class="sc">~</span><span class="fu">mean</span>(.x, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb41-191"><a href="#cb41-191" aria-hidden="true" tabindex="-1"></a>    <span class="at">.before =</span> <span class="fu">days</span>(<span class="dv">7</span>)</span>
<span id="cb41-192"><a href="#cb41-192" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb41-193"><a href="#cb41-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-194"><a href="#cb41-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-195"><a href="#cb41-195" aria-hidden="true" tabindex="-1"></a><span class="co"># dta_test&lt;-dta_tl %&gt;% </span></span>
<span id="cb41-196"><a href="#cb41-196" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(date,no_show,n) %&gt;% </span></span>
<span id="cb41-197"><a href="#cb41-197" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(names_from=no_show,</span></span>
<span id="cb41-198"><a href="#cb41-198" aria-hidden="true" tabindex="-1"></a><span class="co">#               values_from=n)</span></span>
<span id="cb41-199"><a href="#cb41-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-200"><a href="#cb41-200" aria-hidden="true" tabindex="-1"></a><span class="co"># noshow_n_days&lt;-dta_tl %&gt;% filter(no_show=="No") %&gt;% select(n)</span></span>
<span id="cb41-201"><a href="#cb41-201" aria-hidden="true" tabindex="-1"></a><span class="co"># noshow_y_days&lt;-dta_tl %&gt;% filter(no_show=="Yes") %&gt;% select(n)</span></span>
<span id="cb41-202"><a href="#cb41-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-203"><a href="#cb41-203" aria-hidden="true" tabindex="-1"></a><span class="co"># t.test(noshow_n_days$n ~ noshow_y_days$n)</span></span>
<span id="cb41-204"><a href="#cb41-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-205"><a href="#cb41-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-206"><a href="#cb41-206" aria-hidden="true" tabindex="-1"></a><span class="do">## T test,... is the noshow days different with total appts in each day??</span></span>
<span id="cb41-207"><a href="#cb41-207" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(n<span class="sc">~</span>no_show, <span class="at">data=</span>dta_tl) <span class="sc">%&gt;%</span> </span>
<span id="cb41-208"><a href="#cb41-208" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-209"><a href="#cb41-209" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb41-210"><a href="#cb41-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-211"><a href="#cb41-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-212"><a href="#cb41-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-213"><a href="#cb41-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-214"><a href="#cb41-214" aria-hidden="true" tabindex="-1"></a>The difference is significant at least.</span>
<span id="cb41-215"><a href="#cb41-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-216"><a href="#cb41-216" aria-hidden="true" tabindex="-1"></a>Now make the line graph, any changes over time?</span>
<span id="cb41-217"><a href="#cb41-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-220"><a href="#cb41-220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-221"><a href="#cb41-221" aria-hidden="true" tabindex="-1"></a>dta_tl <span class="sc">%&gt;%</span> </span>
<span id="cb41-222"><a href="#cb41-222" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pivot_longer(cols=all_of(c("appointment_day",</span></span>
<span id="cb41-223"><a href="#cb41-223" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                          "scheduled_day")),</span></span>
<span id="cb41-224"><a href="#cb41-224" aria-hidden="true" tabindex="-1"></a>  <span class="co">#              names_to="date_type",</span></span>
<span id="cb41-225"><a href="#cb41-225" aria-hidden="true" tabindex="-1"></a>  <span class="co">#              values_to="date") %&gt;% </span></span>
<span id="cb41-226"><a href="#cb41-226" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select(no_show,contains("date"),contains("n_"))</span></span>
<span id="cb41-227"><a href="#cb41-227" aria-hidden="true" tabindex="-1"></a>  <span class="co"># summarize(appt=n(appointment_day),</span></span>
<span id="cb41-228"><a href="#cb41-228" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           sched=n(scheduled_day))</span></span>
<span id="cb41-229"><a href="#cb41-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>date)) <span class="sc">+</span></span>
<span id="cb41-230"><a href="#cb41-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">y=</span>n),<span class="at">fill=</span><span class="st">"grey80"</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb41-231"><a href="#cb41-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>mean_seven_day, <span class="at">color=</span>date_type),<span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb41-232"><a href="#cb41-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels=</span><span class="st">"%Y %b %d"</span>) <span class="sc">+</span></span>
<span id="cb41-233"><a href="#cb41-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>no_show, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales=</span><span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb41-234"><a href="#cb41-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-235"><a href="#cb41-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb41-236"><a href="#cb41-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Was the appointment a no show? Shown over duration of dataset"</span>)</span>
<span id="cb41-237"><a href="#cb41-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-238"><a href="#cb41-238" aria-hidden="true" tabindex="-1"></a>dta_tl <span class="sc">%&gt;%</span> </span>
<span id="cb41-239"><a href="#cb41-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span>
<span id="cb41-240"><a href="#cb41-240" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("slider")</span></span>
<span id="cb41-241"><a href="#cb41-241" aria-hidden="true" tabindex="-1"></a><span class="co"># library(slider)</span></span>
<span id="cb41-242"><a href="#cb41-242" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("tidyquant")</span></span>
<span id="cb41-243"><a href="#cb41-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-244"><a href="#cb41-244" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(dta$appointment_day)</span></span>
<span id="cb41-245"><a href="#cb41-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-246"><a href="#cb41-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-247"><a href="#cb41-247" aria-hidden="true" tabindex="-1"></a>Looks like not much difference in temporal trends of noshows.</span>
<span id="cb41-248"><a href="#cb41-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-249"><a href="#cb41-249" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cleaning and Cross Correlation</span></span>
<span id="cb41-250"><a href="#cb41-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-251"><a href="#cb41-251" aria-hidden="true" tabindex="-1"></a>That was fun. Now lets clean up the data to perform a logistic regression and then see how to use prediction methods...</span>
<span id="cb41-252"><a href="#cb41-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-253"><a href="#cb41-253" aria-hidden="true" tabindex="-1"></a>1<span class="sc">\)</span> Clean up data</span>
<span id="cb41-254"><a href="#cb41-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-257"><a href="#cb41-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-258"><a href="#cb41-258" aria-hidden="true" tabindex="-1"></a>dta_clean <span class="ot">&lt;-</span> dta <span class="sc">%&gt;%</span> </span>
<span id="cb41-259"><a href="#cb41-259" aria-hidden="true" tabindex="-1"></a>  <span class="co">#remove duplicate appointments for same patient and same day</span></span>
<span id="cb41-260"><a href="#cb41-260" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">duplicated</span>(<span class="fu">across</span>(<span class="sc">-</span>appointment_id))) <span class="sc">%&gt;%</span> </span>
<span id="cb41-261"><a href="#cb41-261" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create a day of the week variable</span></span>
<span id="cb41-262"><a href="#cb41-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wday=</span><span class="fu">wday</span>(appointment_day,<span class="at">label=</span><span class="cn">TRUE</span>,<span class="at">abbr=</span><span class="cn">TRUE</span>),</span>
<span id="cb41-263"><a href="#cb41-263" aria-hidden="true" tabindex="-1"></a>         <span class="at">is_friday=</span><span class="fu">as.factor</span>(<span class="fu">if_else</span>(wday<span class="sc">==</span><span class="st">"Fri"</span>,<span class="dv">1</span>,<span class="dv">0</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb41-264"><a href="#cb41-264" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create var number of patients seen at clinic/neighborhood in total</span></span>
<span id="cb41-265"><a href="#cb41-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(neighbourhood,<span class="at">name=</span><span class="st">"neigh_appts"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-266"><a href="#cb41-266" aria-hidden="true" tabindex="-1"></a>    <span class="co"># factorize vars and create a diff between appt and scheduled date</span></span>
<span id="cb41-267"><a href="#cb41-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender=</span><span class="fu">as.factor</span>(gender),</span>
<span id="cb41-268"><a href="#cb41-268" aria-hidden="true" tabindex="-1"></a>         <span class="at">gender_male=</span><span class="fu">as.factor</span>(<span class="fu">if_else</span>(gender<span class="sc">==</span><span class="st">"M"</span>,<span class="dv">1</span>,<span class="dv">0</span>)),</span>
<span id="cb41-269"><a href="#cb41-269" aria-hidden="true" tabindex="-1"></a>         <span class="at">attended=</span><span class="fu">as.factor</span>(<span class="fu">case_match</span>(no_show,</span>
<span id="cb41-270"><a href="#cb41-270" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"No"</span><span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb41-271"><a href="#cb41-271" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Yes"</span><span class="sc">~</span><span class="dv">0</span>)),</span>
<span id="cb41-272"><a href="#cb41-272" aria-hidden="true" tabindex="-1"></a>         <span class="at">days_since_call=</span><span class="fu">as.double</span>(<span class="fu">difftime</span>(appointment_day, scheduled_day, <span class="at">units=</span><span class="st">"days"</span>))</span>
<span id="cb41-273"><a href="#cb41-273" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb41-274"><a href="#cb41-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(scholarship<span class="sc">:</span>sms_received, as.factor)) <span class="sc">%&gt;%</span></span>
<span id="cb41-275"><a href="#cb41-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"_id"</span>),as.factor)) <span class="sc">%&gt;%</span></span>
<span id="cb41-276"><a href="#cb41-276" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create tallies</span></span>
<span id="cb41-277"><a href="#cb41-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(patient_id,appointment_day) <span class="sc">%&gt;%</span> </span>
<span id="cb41-278"><a href="#cb41-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(patient_id, <span class="at">name=</span><span class="st">"appt_count"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-279"><a href="#cb41-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(patient_id) <span class="sc">%&gt;%</span></span>
<span id="cb41-280"><a href="#cb41-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"one"</span><span class="ot">=</span><span class="dv">1</span>,</span>
<span id="cb41-281"><a href="#cb41-281" aria-hidden="true" tabindex="-1"></a>         <span class="st">"appt_tally"</span><span class="ot">=</span><span class="fu">cumsum</span>(one)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>one) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb41-282"><a href="#cb41-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-283"><a href="#cb41-283" aria-hidden="true" tabindex="-1"></a>dta_clean <span class="sc">%&gt;%</span></span>
<span id="cb41-284"><a href="#cb41-284" aria-hidden="true" tabindex="-1"></a>  <span class="co"># colnames() %&gt;% </span></span>
<span id="cb41-285"><a href="#cb41-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>patient_id <span class="sc">&amp;</span> <span class="sc">!</span>appointment_id) <span class="sc">%&gt;%</span> </span>
<span id="cb41-286"><a href="#cb41-286" aria-hidden="true" tabindex="-1"></a>  skimr<span class="sc">::</span><span class="fu">skim</span>()</span>
<span id="cb41-287"><a href="#cb41-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-288"><a href="#cb41-288" aria-hidden="true" tabindex="-1"></a>dta_clean</span>
<span id="cb41-289"><a href="#cb41-289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-290"><a href="#cb41-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-291"><a href="#cb41-291" aria-hidden="true" tabindex="-1"></a>2<span class="sc">\)</span> Correlation matrix with cleaned data</span>
<span id="cb41-292"><a href="#cb41-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-295"><a href="#cb41-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-296"><a href="#cb41-296" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("ggcorrplot")</span></span>
<span id="cb41-297"><a href="#cb41-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-298"><a href="#cb41-298" aria-hidden="true" tabindex="-1"></a>dta_clean_noid<span class="ot">&lt;-</span>dta_clean  <span class="sc">%&gt;%</span>   </span>
<span id="cb41-299"><a href="#cb41-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>patient_id <span class="sc">&amp;</span> <span class="sc">!</span>appointment_id <span class="sc">&amp;</span> <span class="sc">!</span>handcap <span class="sc">&amp;</span> <span class="sc">!</span>gender_male <span class="sc">&amp;</span> <span class="sc">!</span>wday) <span class="sc">%&gt;%</span> </span>
<span id="cb41-300"><a href="#cb41-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.factor))</span>
<span id="cb41-301"><a href="#cb41-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-302"><a href="#cb41-302" aria-hidden="true" tabindex="-1"></a>dta_clean_noid</span>
<span id="cb41-303"><a href="#cb41-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-304"><a href="#cb41-304" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(<span class="sc">~</span><span class="dv">0</span><span class="sc">+</span>., <span class="at">data=</span>dta_clean_noid) <span class="sc">%&gt;%</span> </span>
<span id="cb41-305"><a href="#cb41-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(<span class="at">use=</span><span class="st">"pairwise.complete.obs"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-306"><a href="#cb41-306" aria-hidden="true" tabindex="-1"></a>  ggcorrplot<span class="sc">::</span><span class="fu">ggcorrplot</span>(<span class="at">show.diag =</span> F,<span class="at">type=</span><span class="st">"lower"</span>,<span class="at">lab=</span><span class="cn">TRUE</span>, <span class="at">lab_size=</span><span class="dv">2</span>, <span class="at">digits=</span><span class="dv">3</span>)</span>
<span id="cb41-307"><a href="#cb41-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-308"><a href="#cb41-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-309"><a href="#cb41-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-310"><a href="#cb41-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-311"><a href="#cb41-311" aria-hidden="true" tabindex="-1"></a><span class="fu">## Predictions with Logistic Regression</span></span>
<span id="cb41-312"><a href="#cb41-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-313"><a href="#cb41-313" aria-hidden="true" tabindex="-1"></a>Following workflow from: <span class="ot">&lt;https://www.tidymodels.org/start/case-study/&gt;</span></span>
<span id="cb41-314"><a href="#cb41-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-315"><a href="#cb41-315" aria-hidden="true" tabindex="-1"></a>1<span class="sc">\)</span> Split into training and validation and test sets</span>
<span id="cb41-316"><a href="#cb41-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-319"><a href="#cb41-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-320"><a href="#cb41-320" aria-hidden="true" tabindex="-1"></a><span class="co"># some of these vars are not necesary now or better processed by recipe</span></span>
<span id="cb41-321"><a href="#cb41-321" aria-hidden="true" tabindex="-1"></a><span class="co"># outcome is still attended</span></span>
<span id="cb41-322"><a href="#cb41-322" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb41-323"><a href="#cb41-323" aria-hidden="true" tabindex="-1"></a>dta_clean2<span class="ot">&lt;-</span>dta_clean <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-324"><a href="#cb41-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(gender,scheduled_day,wday,is_friday,no_show,neighbourhood, patient_id))</span>
<span id="cb41-325"><a href="#cb41-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-326"><a href="#cb41-326" aria-hidden="true" tabindex="-1"></a>splits      <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(dta_clean2, <span class="at">strata =</span> attended)</span>
<span id="cb41-327"><a href="#cb41-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-328"><a href="#cb41-328" aria-hidden="true" tabindex="-1"></a>appts_other <span class="ot">&lt;-</span> <span class="fu">training</span>(splits)</span>
<span id="cb41-329"><a href="#cb41-329" aria-hidden="true" tabindex="-1"></a>appts_test  <span class="ot">&lt;-</span> <span class="fu">testing</span>(splits)</span>
<span id="cb41-330"><a href="#cb41-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-331"><a href="#cb41-331" aria-hidden="true" tabindex="-1"></a><span class="co"># appts_other %&gt;% </span></span>
<span id="cb41-332"><a href="#cb41-332" aria-hidden="true" tabindex="-1"></a><span class="co">#   count(attended) %&gt;% </span></span>
<span id="cb41-333"><a href="#cb41-333" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(prop = n/sum(n))</span></span>
<span id="cb41-334"><a href="#cb41-334" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-335"><a href="#cb41-335" aria-hidden="true" tabindex="-1"></a><span class="co"># appts_test %&gt;% </span></span>
<span id="cb41-336"><a href="#cb41-336" aria-hidden="true" tabindex="-1"></a><span class="co">#   count(attended) %&gt;% </span></span>
<span id="cb41-337"><a href="#cb41-337" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(prop = n/sum(n))</span></span>
<span id="cb41-338"><a href="#cb41-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-339"><a href="#cb41-339" aria-hidden="true" tabindex="-1"></a><span class="co"># appts_other</span></span>
<span id="cb41-340"><a href="#cb41-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-341"><a href="#cb41-341" aria-hidden="true" tabindex="-1"></a>val_set <span class="ot">&lt;-</span> <span class="fu">validation_split</span>(appts_other, </span>
<span id="cb41-342"><a href="#cb41-342" aria-hidden="true" tabindex="-1"></a>                            <span class="at">strata =</span> attended, </span>
<span id="cb41-343"><a href="#cb41-343" aria-hidden="true" tabindex="-1"></a>                            <span class="at">prop =</span> <span class="fu">c</span>(<span class="fl">0.8</span>))</span>
<span id="cb41-344"><a href="#cb41-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-345"><a href="#cb41-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-346"><a href="#cb41-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-347"><a href="#cb41-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-348"><a href="#cb41-348" aria-hidden="true" tabindex="-1"></a>2<span class="sc">\)</span> Build the model</span>
<span id="cb41-349"><a href="#cb41-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-352"><a href="#cb41-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-353"><a href="#cb41-353" aria-hidden="true" tabindex="-1"></a>lr_mod <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-354"><a href="#cb41-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>)</span>
<span id="cb41-355"><a href="#cb41-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-356"><a href="#cb41-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-357"><a href="#cb41-357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-358"><a href="#cb41-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-359"><a href="#cb41-359" aria-hidden="true" tabindex="-1"></a>3<span class="sc">\)</span> Build the "recipe" to preprocess the data</span>
<span id="cb41-360"><a href="#cb41-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-363"><a href="#cb41-363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-364"><a href="#cb41-364" aria-hidden="true" tabindex="-1"></a>lr_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(attended <span class="sc">~</span> ., <span class="at">data =</span> appts_other) <span class="sc">%&gt;%</span> </span>
<span id="cb41-365"><a href="#cb41-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(appointment_id, <span class="at">new_role =</span> <span class="st">"ID"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-366"><a href="#cb41-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span>(appointment_day, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"dow"</span>, <span class="st">"month"</span>)) <span class="sc">%&gt;%</span>               </span>
<span id="cb41-367"><a href="#cb41-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(appointment_day) <span class="sc">%&gt;%</span> </span>
<span id="cb41-368"><a href="#cb41-368" aria-hidden="true" tabindex="-1"></a>  <span class="co"># step_corr(all_numeric_predictors(), threshold = .5)</span></span>
<span id="cb41-369"><a href="#cb41-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb41-370"><a href="#cb41-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb41-371"><a href="#cb41-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb41-372"><a href="#cb41-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-373"><a href="#cb41-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-374"><a href="#cb41-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-375"><a href="#cb41-375" aria-hidden="true" tabindex="-1"></a>4<span class="sc">\)</span> Now we add a workflow, combining the model and recipe</span>
<span id="cb41-376"><a href="#cb41-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-379"><a href="#cb41-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-380"><a href="#cb41-380" aria-hidden="true" tabindex="-1"></a>lr_workflow<span class="ot">&lt;-</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-381"><a href="#cb41-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lr_mod) <span class="sc">%&gt;%</span> </span>
<span id="cb41-382"><a href="#cb41-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(lr_recipe)</span>
<span id="cb41-383"><a href="#cb41-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-384"><a href="#cb41-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-385"><a href="#cb41-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-386"><a href="#cb41-386" aria-hidden="true" tabindex="-1"></a>5<span class="sc">\)</span> Create penalty values for tuning</span>
<span id="cb41-387"><a href="#cb41-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-390"><a href="#cb41-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-391"><a href="#cb41-391" aria-hidden="true" tabindex="-1"></a>lr_reg_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">penalty =</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">40</span>))</span>
<span id="cb41-392"><a href="#cb41-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-393"><a href="#cb41-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-394"><a href="#cb41-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-395"><a href="#cb41-395" aria-hidden="true" tabindex="-1"></a>6<span class="sc">\)</span> Now we apply these each of these penalty values to the workflow (ie with recipe and model)</span>
<span id="cb41-396"><a href="#cb41-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-399"><a href="#cb41-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-400"><a href="#cb41-400" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">321</span>)</span>
<span id="cb41-401"><a href="#cb41-401" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("glmnet")</span></span>
<span id="cb41-402"><a href="#cb41-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-403"><a href="#cb41-403" aria-hidden="true" tabindex="-1"></a>lr_res <span class="ot">&lt;-</span> lr_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb41-404"><a href="#cb41-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(val_set,</span>
<span id="cb41-405"><a href="#cb41-405" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> lr_reg_grid,</span>
<span id="cb41-406"><a href="#cb41-406" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>),</span>
<span id="cb41-407"><a href="#cb41-407" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc))</span>
<span id="cb41-408"><a href="#cb41-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-409"><a href="#cb41-409" aria-hidden="true" tabindex="-1"></a>lr_plot <span class="ot">&lt;-</span> </span>
<span id="cb41-410"><a href="#cb41-410" aria-hidden="true" tabindex="-1"></a>  lr_res <span class="sc">%&gt;%</span> </span>
<span id="cb41-411"><a href="#cb41-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-412"><a href="#cb41-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> penalty, <span class="at">y =</span> mean)) <span class="sc">+</span> </span>
<span id="cb41-413"><a href="#cb41-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb41-414"><a href="#cb41-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb41-415"><a href="#cb41-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Area under the ROC Curve"</span>)</span>
<span id="cb41-416"><a href="#cb41-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-417"><a href="#cb41-417" aria-hidden="true" tabindex="-1"></a>lr_plot </span>
<span id="cb41-418"><a href="#cb41-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-419"><a href="#cb41-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-420"><a href="#cb41-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-421"><a href="#cb41-421" aria-hidden="true" tabindex="-1"></a>Lets try to find the best model... looks like higher penalty actually performs better!!</span>
<span id="cb41-422"><a href="#cb41-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-425"><a href="#cb41-425" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-426"><a href="#cb41-426" aria-hidden="true" tabindex="-1"></a>lr_res <span class="sc">%&gt;%</span> </span>
<span id="cb41-427"><a href="#cb41-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-428"><a href="#cb41-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(penalty) <span class="sc">%&gt;%</span> </span>
<span id="cb41-429"><a href="#cb41-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>()</span>
<span id="cb41-430"><a href="#cb41-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-431"><a href="#cb41-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-432"><a href="#cb41-432" aria-hidden="true" tabindex="-1"></a><span class="do">###Seems to be row 38... high mean roc_auc while also being the highest penalty</span></span>
<span id="cb41-433"><a href="#cb41-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-434"><a href="#cb41-434" aria-hidden="true" tabindex="-1"></a>lr_best<span class="ot">&lt;-</span>  lr_res <span class="sc">%&gt;%</span> </span>
<span id="cb41-435"><a href="#cb41-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-436"><a href="#cb41-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(penalty) <span class="sc">%&gt;%</span> </span>
<span id="cb41-437"><a href="#cb41-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">38</span>)</span>
<span id="cb41-438"><a href="#cb41-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-439"><a href="#cb41-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-440"><a href="#cb41-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-441"><a href="#cb41-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-442"><a href="#cb41-442" aria-hidden="true" tabindex="-1"></a>OK, now lets see how this ROC curve looks for the best fit log model....</span>
<span id="cb41-443"><a href="#cb41-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-446"><a href="#cb41-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-447"><a href="#cb41-447" aria-hidden="true" tabindex="-1"></a>lr_auc <span class="ot">&lt;-</span> lr_res <span class="sc">%&gt;%</span> </span>
<span id="cb41-448"><a href="#cb41-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>(<span class="at">parameters =</span> lr_best) <span class="sc">%&gt;%</span> </span>
<span id="cb41-449"><a href="#cb41-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(attended, .pred_0) <span class="sc">%&gt;%</span> </span>
<span id="cb41-450"><a href="#cb41-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"Logistic Regression"</span>) </span>
<span id="cb41-451"><a href="#cb41-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-452"><a href="#cb41-452" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(lr_auc)</span>
<span id="cb41-453"><a href="#cb41-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-454"><a href="#cb41-454" aria-hidden="true" tabindex="-1"></a>lr_res <span class="sc">%&gt;%</span> </span>
<span id="cb41-455"><a href="#cb41-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>(<span class="at">parameters =</span> lr_best) </span>
<span id="cb41-456"><a href="#cb41-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-457"><a href="#cb41-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-458"><a href="#cb41-458" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-459"><a href="#cb41-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-460"><a href="#cb41-460" aria-hidden="true" tabindex="-1"></a>its... not great!</span>
<span id="cb41-461"><a href="#cb41-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-462"><a href="#cb41-462" aria-hidden="true" tabindex="-1"></a>But we can see how it would fit onto the test data now.</span>
<span id="cb41-463"><a href="#cb41-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-466"><a href="#cb41-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-467"><a href="#cb41-467" aria-hidden="true" tabindex="-1"></a>last_log_mod <span class="ot">&lt;-</span>  <span class="fu">logistic_reg</span>(<span class="at">penalty =</span> lr_best<span class="sc">$</span>penalty[<span class="dv">1</span>], <span class="at">mixture=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-468"><a href="#cb41-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>, <span class="at">importance=</span><span class="st">"BIC"</span>)</span>
<span id="cb41-469"><a href="#cb41-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-470"><a href="#cb41-470" aria-hidden="true" tabindex="-1"></a><span class="co"># the last workflow</span></span>
<span id="cb41-471"><a href="#cb41-471" aria-hidden="true" tabindex="-1"></a>last_log_workflow <span class="ot">&lt;-</span> lr_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb41-472"><a href="#cb41-472" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">update_model</span>(last_log_mod)</span>
<span id="cb41-473"><a href="#cb41-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-474"><a href="#cb41-474" aria-hidden="true" tabindex="-1"></a><span class="co"># last fit</span></span>
<span id="cb41-475"><a href="#cb41-475" aria-hidden="true" tabindex="-1"></a>last_lr_fit<span class="ot">&lt;-</span> last_log_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb41-476"><a href="#cb41-476" aria-hidden="true" tabindex="-1"></a>              <span class="fu">last_fit</span>(splits)</span>
<span id="cb41-477"><a href="#cb41-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-478"><a href="#cb41-478" aria-hidden="true" tabindex="-1"></a><span class="co"># show metrics</span></span>
<span id="cb41-479"><a href="#cb41-479" aria-hidden="true" tabindex="-1"></a>last_lr_fit <span class="sc">%&gt;%</span> </span>
<span id="cb41-480"><a href="#cb41-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span>
<span id="cb41-481"><a href="#cb41-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-482"><a href="#cb41-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-483"><a href="#cb41-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-484"><a href="#cb41-484" aria-hidden="true" tabindex="-1"></a>About same ROC as with validation set...</span>
<span id="cb41-485"><a href="#cb41-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-486"><a href="#cb41-486" aria-hidden="true" tabindex="-1"></a>7<span class="sc">\)</span> Finally, we look at the top variables/features included</span>
<span id="cb41-487"><a href="#cb41-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-490"><a href="#cb41-490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-491"><a href="#cb41-491" aria-hidden="true" tabindex="-1"></a>last_lr_fit <span class="sc">%&gt;%</span> </span>
<span id="cb41-492"><a href="#cb41-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-493"><a href="#cb41-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">20</span>, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">fill=</span>Sign)) <span class="sc">+</span></span>
<span id="cb41-494"><a href="#cb41-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb41-495"><a href="#cb41-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-496"><a href="#cb41-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-497"><a href="#cb41-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-498"><a href="#cb41-498" aria-hidden="true" tabindex="-1"></a>Looks like the days since the last call was most important by far!!!</span>
<span id="cb41-499"><a href="#cb41-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-500"><a href="#cb41-500" aria-hidden="true" tabindex="-1"></a>Next after was the SMS received... but from correlation matrix, it seemed to have an inverse effect. Should explore more!</span>
<span id="cb41-501"><a href="#cb41-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-504"><a href="#cb41-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-505"><a href="#cb41-505" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-506"><a href="#cb41-506" aria-hidden="true" tabindex="-1"></a><span class="co"># cor.test(dta_clean$sms_received, dta_clean$no_show)</span></span>
<span id="cb41-507"><a href="#cb41-507" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb41-508"><a href="#cb41-508" aria-hidden="true" tabindex="-1"></a><span class="co"># chisq.test(dta_clean$sms_received, dta_clean$no_show)</span></span>
<span id="cb41-509"><a href="#cb41-509" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-510"><a href="#cb41-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-511"><a href="#cb41-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-512"><a href="#cb41-512" aria-hidden="true" tabindex="-1"></a><span class="fu">## DHIS2 Hypertension Registry Test Run</span></span>
<span id="cb41-513"><a href="#cb41-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-516"><a href="#cb41-516" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-517"><a href="#cb41-517" aria-hidden="true" tabindex="-1"></a><span class="co"># library(readxl)</span></span>
<span id="cb41-518"><a href="#cb41-518" aria-hidden="true" tabindex="-1"></a>dhis<span class="ot">&lt;-</span>readxl<span class="sc">::</span><span class="fu">read_xls</span>(<span class="st">"dhis.xls"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-519"><a href="#cb41-519" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb41-520"><a href="#cb41-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-521"><a href="#cb41-521" aria-hidden="true" tabindex="-1"></a>dhis_clean<span class="ot">&lt;-</span>dhis <span class="sc">%&gt;%</span> </span>
<span id="cb41-522"><a href="#cb41-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"date"</span>), as.Date)) <span class="sc">%&gt;%</span> <span class="co"># convert to date everything thats a date</span></span>
<span id="cb41-523"><a href="#cb41-523" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"mm_hg"</span>),as.double)) <span class="sc">%&gt;%</span> <span class="co"># BP should be character</span></span>
<span id="cb41-524"><a href="#cb41-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gen_address_current,gen_given_name,gen_date_of_birth) <span class="sc">%&gt;%</span> <span class="co">#create patient IDs based on address DOB name</span></span>
<span id="cb41-525"><a href="#cb41-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">patient_id=</span><span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb41-526"><a href="#cb41-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">has_support=</span><span class="sc">!</span><span class="fu">is.na</span>(supporters_name), <span class="co">#add a dummy var if patient has a supporter</span></span>
<span id="cb41-527"><a href="#cb41-527" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex=</span>gen_sex,</span>
<span id="cb41-528"><a href="#cb41-528" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_at_entry=</span><span class="fu">floor</span>(lubridate<span class="sc">::</span><span class="fu">time_length</span>(<span class="fu">difftime</span>(registration_date, gen_date_of_birth), </span>
<span id="cb41-529"><a href="#cb41-529" aria-hidden="true" tabindex="-1"></a>                                                                <span class="st">"years"</span>)) <span class="co">#calc age and sex</span></span>
<span id="cb41-530"><a href="#cb41-530" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb41-531"><a href="#cb41-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(<span class="at">name=</span><span class="st">"total_patient_visits"</span>) <span class="sc">%&gt;%</span> <span class="co"># counter for total patients visits</span></span>
<span id="cb41-532"><a href="#cb41-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-533"><a href="#cb41-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(patient_id,event_date) <span class="sc">%&gt;%</span> <span class="co">#now make a running tally for each patient visits</span></span>
<span id="cb41-534"><a href="#cb41-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(patient_id) <span class="sc">%&gt;%</span></span>
<span id="cb41-535"><a href="#cb41-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"one"</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">"appt_tally"</span><span class="ot">=</span><span class="fu">cumsum</span>(one)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-536"><a href="#cb41-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>one) <span class="sc">%&gt;%</span> </span>
<span id="cb41-537"><a href="#cb41-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-538"><a href="#cb41-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">days_since_entry=</span><span class="fu">as.double</span>(<span class="fu">difftime</span>(registration_date, event_date, <span class="at">units=</span><span class="st">"days"</span>))) <span class="sc">%&gt;%</span> <span class="co">#days since entry</span></span>
<span id="cb41-539"><a href="#cb41-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"gen"</span>) <span class="sc">&amp;</span> <span class="sc">!</span>supporters_name)</span>
<span id="cb41-540"><a href="#cb41-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-541"><a href="#cb41-541" aria-hidden="true" tabindex="-1"></a><span class="co"># dhis %&gt;% </span></span>
<span id="cb41-542"><a href="#cb41-542" aria-hidden="true" tabindex="-1"></a><span class="co">#   count(has_support)</span></span>
<span id="cb41-543"><a href="#cb41-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-544"><a href="#cb41-544" aria-hidden="true" tabindex="-1"></a><span class="co"># dhis_clean %&gt;% head()</span></span>
<span id="cb41-545"><a href="#cb41-545" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-546"><a href="#cb41-546" aria-hidden="true" tabindex="-1"></a><span class="co"># dhis %&gt;% </span></span>
<span id="cb41-547"><a href="#cb41-547" aria-hidden="true" tabindex="-1"></a><span class="co">#   colnames()</span></span>
<span id="cb41-548"><a href="#cb41-548" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-549"><a href="#cb41-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-550"><a href="#cb41-550" aria-hidden="true" tabindex="-1"></a>Still need to clean up the presecriptions etc...</span>
<span id="cb41-551"><a href="#cb41-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-552"><a href="#cb41-552" aria-hidden="true" tabindex="-1"></a>Process it for the **Table1**</span>
<span id="cb41-553"><a href="#cb41-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-556"><a href="#cb41-556" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-557"><a href="#cb41-557" aria-hidden="true" tabindex="-1"></a>dhis_table <span class="ot">&lt;-</span> dhis_clean <span class="sc">%&gt;%</span> </span>
<span id="cb41-558"><a href="#cb41-558" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">patient_returned=</span><span class="fu">if_else</span>(total_patient_visits<span class="sc">&gt;</span><span class="dv">1</span>, <span class="st">"1+ Visits After Entry"</span>,</span>
<span id="cb41-559"><a href="#cb41-559" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"LTFU After Entry"</span></span>
<span id="cb41-560"><a href="#cb41-560" aria-hidden="true" tabindex="-1"></a>                                    )) <span class="sc">%&gt;%</span> </span>
<span id="cb41-561"><a href="#cb41-561" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sbp_level =</span></span>
<span id="cb41-562"><a href="#cb41-562" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb41-563"><a href="#cb41-563" aria-hidden="true" tabindex="-1"></a>        ncd_systole_mm_hg <span class="sc">&gt;=</span> <span class="dv">140</span>                         <span class="sc">~</span> <span class="st">"very_high"</span>,</span>
<span id="cb41-564"><a href="#cb41-564" aria-hidden="true" tabindex="-1"></a>        ncd_systole_mm_hg <span class="sc">&gt;=</span> <span class="dv">130</span> <span class="sc">&amp;</span> ncd_systole_mm_hg <span class="sc">&lt;</span> <span class="dv">140</span> <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb41-565"><a href="#cb41-565" aria-hidden="true" tabindex="-1"></a>        ncd_systole_mm_hg <span class="sc">&gt;=</span> <span class="dv">120</span> <span class="sc">&amp;</span> ncd_systole_mm_hg <span class="sc">&lt;</span> <span class="dv">130</span> <span class="sc">~</span> <span class="st">"elevated"</span>,</span>
<span id="cb41-566"><a href="#cb41-566" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.na</span>(ncd_systole_mm_hg) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb41-567"><a href="#cb41-567" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"normal"</span></span>
<span id="cb41-568"><a href="#cb41-568" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb41-569"><a href="#cb41-569" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb41-570"><a href="#cb41-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sbp_level=</span><span class="fu">fct_relevel</span>(sbp_level, </span>
<span id="cb41-571"><a href="#cb41-571" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">c</span>(<span class="st">"normal"</span>,<span class="st">"elevated"</span>,<span class="st">"high"</span>,</span>
<span id="cb41-572"><a href="#cb41-572" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"very_high"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb41-573"><a href="#cb41-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">as.factor</span>(<span class="fu">cut</span>(age_at_entry, </span>
<span id="cb41-574"><a href="#cb41-574" aria-hidden="true" tabindex="-1"></a>                         <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">55</span>, <span class="dv">60</span>, <span class="dv">75</span>, <span class="dv">100</span>), </span>
<span id="cb41-575"><a href="#cb41-575" aria-hidden="true" tabindex="-1"></a>                         <span class="at">include.lowest =</span> T, </span>
<span id="cb41-576"><a href="#cb41-576" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"40-55"</span>,<span class="st">"55-60"</span>, <span class="st">"60-75"</span>, <span class="st">"75-100"</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb41-577"><a href="#cb41-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(patient_returned, sex, age_group, appt_tally,</span>
<span id="cb41-578"><a href="#cb41-578" aria-hidden="true" tabindex="-1"></a>         <span class="st">"sbp_baseline"</span><span class="ot">=</span>sbp_level, <span class="st">"amlodipine_baseline"</span><span class="ot">=</span>med_amlodipine) <span class="sc">%&gt;%</span> </span>
<span id="cb41-579"><a href="#cb41-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appt_tally<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb41-580"><a href="#cb41-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-581"><a href="#cb41-581" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(dhis_clean$age_at_entry)</span></span>
<span id="cb41-582"><a href="#cb41-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-583"><a href="#cb41-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-584"><a href="#cb41-584" aria-hidden="true" tabindex="-1"></a>table1<span class="sc">::</span><span class="fu">table1</span>(<span class="sc">~</span> sex <span class="sc">+</span> age_group <span class="sc">+</span> sbp_baseline <span class="sc">+</span> amlodipine_baseline <span class="sc">|</span> <span class="fu">factor</span>(patient_returned), <span class="at">data=</span>dhis_table) </span>
<span id="cb41-585"><a href="#cb41-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-586"><a href="#cb41-586" aria-hidden="true" tabindex="-1"></a><span class="co"># dhis_clean %&gt;% </span></span>
<span id="cb41-587"><a href="#cb41-587" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(is.na(ncd_systole_mm_hg))</span></span>
<span id="cb41-588"><a href="#cb41-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-589"><a href="#cb41-589" aria-hidden="true" tabindex="-1"></a><span class="co"># dhis_clean %&gt;% </span></span>
<span id="cb41-590"><a href="#cb41-590" aria-hidden="true" tabindex="-1"></a><span class="co">#   count(total_patient_visits)</span></span>
<span id="cb41-591"><a href="#cb41-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-592"><a href="#cb41-592" aria-hidden="true" tabindex="-1"></a><span class="co"># dhis_clean %&gt;% </span></span>
<span id="cb41-593"><a href="#cb41-593" aria-hidden="true" tabindex="-1"></a><span class="co">#   count()</span></span>
<span id="cb41-594"><a href="#cb41-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-595"><a href="#cb41-595" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-596"><a href="#cb41-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-599"><a href="#cb41-599" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-600"><a href="#cb41-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-601"><a href="#cb41-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-602"><a href="#cb41-602" aria-hidden="true" tabindex="-1"></a>From here:</span>
<span id="cb41-603"><a href="#cb41-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-604"><a href="#cb41-604" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Transform hypertension registry data into "long" appointment dataset</span>
<span id="cb41-605"><a href="#cb41-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-606"><a href="#cb41-606" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Define and import climate / econ variables and add them</span>
<span id="cb41-607"><a href="#cb41-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-608"><a href="#cb41-608" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Validation criteria for prediction model?</span>
<span id="cb41-609"><a href="#cb41-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-610"><a href="#cb41-610" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cox PH - Discrete time or continuous time?</span>
<span id="cb41-611"><a href="#cb41-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-612"><a href="#cb41-612" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Analysis Plan - Outline**</span></span>
<span id="cb41-613"><a href="#cb41-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-614"><a href="#cb41-614" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Import DHIS2 line list data</span>
<span id="cb41-615"><a href="#cb41-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-616"><a href="#cb41-616" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>transform variables as needed and do a data inspection</span>
<span id="cb41-617"><a href="#cb41-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-618"><a href="#cb41-618" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>avg total number of visits per client</span>
<span id="cb41-619"><a href="#cb41-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-620"><a href="#cb41-620" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>appts per month enrolled</span>
<span id="cb41-621"><a href="#cb41-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-622"><a href="#cb41-622" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>missing data analysis</span>
<span id="cb41-623"><a href="#cb41-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-624"><a href="#cb41-624" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>days since last appt for each pnt</span>
<span id="cb41-625"><a href="#cb41-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-626"><a href="#cb41-626" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>mean patient load per month per clinic</span>
<span id="cb41-627"><a href="#cb41-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-628"><a href="#cb41-628" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>hist of total vists by age/region/sex</span>
<span id="cb41-629"><a href="#cb41-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-630"><a href="#cb41-630" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>dummy vars for each of the medications prescribed</span>
<span id="cb41-631"><a href="#cb41-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-632"><a href="#cb41-632" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>and whether prescribed within appropriate window since registration</span>
<span id="cb41-633"><a href="#cb41-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-634"><a href="#cb41-634" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>crosstabs of patient level variables including by attendance status groups</span>
<span id="cb41-635"><a href="#cb41-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-636"><a href="#cb41-636" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>registered without follow up</span>
<span id="cb41-637"><a href="#cb41-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-638"><a href="#cb41-638" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>had follow up and never dropped out until endline</span>
<span id="cb41-639"><a href="#cb41-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-640"><a href="#cb41-640" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>had a follow up</span>
<span id="cb41-641"><a href="#cb41-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-642"><a href="#cb41-642" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>sex and 10year age bands</span>
<span id="cb41-643"><a href="#cb41-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-644"><a href="#cb41-644" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>SBP above or below 180</span>
<span id="cb41-645"><a href="#cb41-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-646"><a href="#cb41-646" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>BMI range at enrollment</span>
<span id="cb41-647"><a href="#cb41-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-648"><a href="#cb41-648" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Add date of next appt to each line</span>
<span id="cb41-649"><a href="#cb41-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-650"><a href="#cb41-650" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Variable if falls within time of ec or env shock</span>
<span id="cb41-651"><a href="#cb41-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-652"><a href="#cb41-652" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>dummy var for season of enrollment</span>
<span id="cb41-653"><a href="#cb41-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-654"><a href="#cb41-654" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Patient return model</span>
<span id="cb41-655"><a href="#cb41-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-656"><a href="#cb41-656" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>logistic reg</span>
<span id="cb41-657"><a href="#cb41-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-658"><a href="#cb41-658" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>include all vars, then LASSO for vars that are relevant</span>
<span id="cb41-659"><a href="#cb41-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-660"><a href="#cb41-660" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>bootstrap resampling</span>
<span id="cb41-661"><a href="#cb41-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-662"><a href="#cb41-662" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>IFF enough patients return for 2+ FU visits (\~40%) then also do a survival analysis for LTFU</span>
<span id="cb41-663"><a href="#cb41-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-664"><a href="#cb41-664" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Cox PH model</span>
<span id="cb41-665"><a href="#cb41-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-666"><a href="#cb41-666" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>include all vars, then LASSO for vars that are relevant</span>
<span id="cb41-667"><a href="#cb41-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-668"><a href="#cb41-668" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>bootstrap resampling</span>
<span id="cb41-669"><a href="#cb41-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-670"><a href="#cb41-670" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>